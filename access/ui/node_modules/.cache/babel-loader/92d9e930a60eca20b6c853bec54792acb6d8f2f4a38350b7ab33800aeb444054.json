{"ast":null,"code":"var _s = $RefreshSig$();\n/**\n * @file useGeneration.js\n * @description 代码生成的自定义Hook\n * \n * 需求:\n * 1. 封装代码生成逻辑，简化组件代码\n * 2. 管理生成状态和结果\n * 3. 处理生成请求和结果获取\n * 4. 提供进度更新通知\n * \n * 返回值:\n * - generation: 当前生成结果\n * - generateCode: 生成代码的函数\n * - progress: 生成进度\n * - downloadCode: 下载代码的函数\n * - loading: 加载状态\n * - error: 错误信息\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { generationService, expectationService } from '../services/api';\nimport webSocketService from '../services/WebSocketService';\n// 导入其他必要依赖\n\n/**\n * 代码生成的自定义Hook\n * @param {string} generationId 生成ID\n */\nconst useGeneration = generationId => {\n  _s();\n  const [generation, setGeneration] = useState(null);\n  const [expectation, setExpectation] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  // 加载生成结果\n  const loadGeneration = useCallback(async id => {\n    if (!id) return;\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await generationService.getGeneration(id);\n      setGeneration(response.data);\n\n      // 如果有相关期望，加载期望信息\n      if (response.data.expectationId) {\n        try {\n          const expResponse = await expectationService.getExpectation(response.data.expectationId);\n          setExpectation(expResponse.data);\n        } catch (expError) {\n          console.error('加载期望信息失败:', expError);\n        }\n      }\n    } catch (err) {\n      setError(err.message || '加载生成结果失败');\n      console.error('加载生成结果失败:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // 初始化WebSocket订阅\n  const initGenerationSubscription = useCallback(id => {\n    if (!id) return null;\n\n    // 订阅生成进度更新\n    const subscription = webSocketService.subscribeToGeneration(id, data => {\n      if (data.progress) {\n        setGeneration(prev => ({\n          ...prev,\n          progress: data.progress,\n          status: data.progress >= 100 ? 'completed' : 'generating'\n        }));\n      }\n      if (data.status) {\n        setGeneration(prev => ({\n          ...prev,\n          status: data.status\n        }));\n      }\n      if (data.files) {\n        setGeneration(prev => ({\n          ...prev,\n          files: data.files\n        }));\n      }\n      if (data.error) {\n        setError(data.error);\n        setGeneration(prev => ({\n          ...prev,\n          status: 'failed',\n          error: data.error\n        }));\n      }\n    });\n    return subscription;\n  }, []);\n\n  // 生成ID变化时加载生成结果\n  useEffect(() => {\n    if (generationId) {\n      loadGeneration(generationId);\n      const subscription = initGenerationSubscription(generationId);\n      return () => {\n        if (subscription) {\n          subscription.unsubscribe();\n        }\n      };\n    }\n  }, [generationId, loadGeneration, initGenerationSubscription]);\n\n  // 下载代码\n  const downloadCode = useCallback(async id => {\n    if (!id) return;\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await generationService.downloadGeneration(id);\n\n      // 创建下载链接\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', `generation-${id}.zip`);\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      return true;\n    } catch (err) {\n      setError(err.message || '下载代码失败');\n      console.error('下载代码失败:', err);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  return {\n    generation,\n    expectation,\n    loadGeneration,\n    downloadCode,\n    loading,\n    error\n  };\n};\n_s(useGeneration, \"HRCtrnjIgxw36fpVBQyyFqO5Iks=\");\nexport default useGeneration;","map":{"version":3,"names":["useState","useEffect","useCallback","generationService","expectationService","webSocketService","useGeneration","generationId","_s","generation","setGeneration","expectation","setExpectation","loading","setLoading","error","setError","loadGeneration","id","response","getGeneration","data","expectationId","expResponse","getExpectation","expError","console","err","message","initGenerationSubscription","subscription","subscribeToGeneration","progress","prev","status","files","unsubscribe","downloadCode","downloadGeneration","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","removeChild"],"sources":["/Users/ziyanzhou/Projects/devin-gen-expeta/access/ui/src/hooks/useGeneration.js"],"sourcesContent":["/**\n * @file useGeneration.js\n * @description 代码生成的自定义Hook\n * \n * 需求:\n * 1. 封装代码生成逻辑，简化组件代码\n * 2. 管理生成状态和结果\n * 3. 处理生成请求和结果获取\n * 4. 提供进度更新通知\n * \n * 返回值:\n * - generation: 当前生成结果\n * - generateCode: 生成代码的函数\n * - progress: 生成进度\n * - downloadCode: 下载代码的函数\n * - loading: 加载状态\n * - error: 错误信息\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { generationService, expectationService } from '../services/api';\nimport webSocketService from '../services/WebSocketService';\n// 导入其他必要依赖\n\n/**\n * 代码生成的自定义Hook\n * @param {string} generationId 生成ID\n */\nconst useGeneration = (generationId) => {\n  const [generation, setGeneration] = useState(null);\n  const [expectation, setExpectation] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  \n  // 加载生成结果\n  const loadGeneration = useCallback(async (id) => {\n    if (!id) return;\n    \n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await generationService.getGeneration(id);\n      setGeneration(response.data);\n      \n      // 如果有相关期望，加载期望信息\n      if (response.data.expectationId) {\n        try {\n          const expResponse = await expectationService.getExpectation(response.data.expectationId);\n          setExpectation(expResponse.data);\n        } catch (expError) {\n          console.error('加载期望信息失败:', expError);\n        }\n      }\n    } catch (err) {\n      setError(err.message || '加载生成结果失败');\n      console.error('加载生成结果失败:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // 初始化WebSocket订阅\n  const initGenerationSubscription = useCallback((id) => {\n    if (!id) return null;\n    \n    // 订阅生成进度更新\n    const subscription = webSocketService.subscribeToGeneration(id, (data) => {\n      if (data.progress) {\n        setGeneration(prev => ({\n          ...prev,\n          progress: data.progress,\n          status: data.progress >= 100 ? 'completed' : 'generating'\n        }));\n      }\n      \n      if (data.status) {\n        setGeneration(prev => ({\n          ...prev,\n          status: data.status\n        }));\n      }\n      \n      if (data.files) {\n        setGeneration(prev => ({\n          ...prev,\n          files: data.files\n        }));\n      }\n      \n      if (data.error) {\n        setError(data.error);\n        setGeneration(prev => ({\n          ...prev,\n          status: 'failed',\n          error: data.error\n        }));\n      }\n    });\n    \n    return subscription;\n  }, []);\n\n  // 生成ID变化时加载生成结果\n  useEffect(() => {\n    if (generationId) {\n      loadGeneration(generationId);\n      const subscription = initGenerationSubscription(generationId);\n      \n      return () => {\n        if (subscription) {\n          subscription.unsubscribe();\n        }\n      };\n    }\n  }, [generationId, loadGeneration, initGenerationSubscription]);\n\n  // 下载代码\n  const downloadCode = useCallback(async (id) => {\n    if (!id) return;\n    \n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await generationService.downloadGeneration(id);\n      \n      // 创建下载链接\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', `generation-${id}.zip`);\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      return true;\n    } catch (err) {\n      setError(err.message || '下载代码失败');\n      console.error('下载代码失败:', err);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  return {\n    generation,\n    expectation,\n    loadGeneration,\n    downloadCode,\n    loading,\n    error\n  };\n};\n\nexport default useGeneration;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}