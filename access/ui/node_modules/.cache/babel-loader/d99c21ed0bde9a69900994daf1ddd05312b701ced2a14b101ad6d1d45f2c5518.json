{"ast":null,"code":"var _jsxFileName = \"/Users/ziyanzhou/Projects/devin-gen-expeta/access/ui/src/components/conversation/ConversationPanel.js\",\n  _s2 = $RefreshSig$();\n/**\n * @file ConversationPanel.js\n * @description 对话面板组件，实现用户与系统的对话交互\n * \n * 需求:\n * 1. 实现对话消息的展示，包括用户消息和系统消息\n * 2. 提供消息输入和发送功能\n * 3. 支持消息历史滚动和加载\n * 4. 显示对话状态和期望确认界面\n * 5. 响应式设计，适应不同屏幕尺寸\n * 6. 使用WebSocket实现实时消息更新\n * \n * 组件属性:\n * - conversationId: 当前会话ID\n * - initialMessages: 初始消息列表\n * - onSendMessage: 发送消息的回调函数\n */\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Box, VStack, HStack, Text, Divider, Alert, AlertIcon, AlertTitle, AlertDescription, Button, useColorModeValue, Flex, Heading, Badge, Progress } from '@chakra-ui/react';\nimport MessageList from './MessageList';\nimport MessageInput from './MessageInput';\nimport { ConversationStates, getStateDescription } from '../../../shared/states/ConversationStates';\n\n/**\n * 对话面板组件，实现用户与系统的对话交互\n * @param {Object} props 组件属性\n * @param {string} props.conversationId 当前会话ID\n * @param {Array} props.initialMessages 初始消息列表\n * @param {Function} props.onSendMessage 发送消息的回调函数\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ConversationPanel = ({\n  conversationId,\n  initialMessages = [],\n  initialState = ConversationStates.INITIAL,\n  initialExpectation = null,\n  onSendMessage,\n  onGenerateCode,\n  onConfirmExpectation,\n  onEditExpectation,\n  loading = false\n}) => {\n  _s2();\n  var _s = $RefreshSig$();\n  const [messages, setMessages] = useState(initialMessages);\n  const [state, setState] = useState(initialState);\n  const [currentExpectation, setCurrentExpectation] = useState(initialExpectation);\n\n  // 状态背景色\n  const stateBgColors = {\n    [ConversationStates.INITIAL]: 'gray.100',\n    [ConversationStates.COLLECTING_REQUIREMENT]: 'blue.50',\n    [ConversationStates.CLARIFYING]: 'blue.100',\n    [ConversationStates.EXPECTATION_DRAFT]: 'green.50',\n    [ConversationStates.EXPECTATION_CONFIRMED]: 'green.100',\n    [ConversationStates.GENERATING]: 'purple.50',\n    [ConversationStates.REVIEWING]: 'orange.50',\n    [ConversationStates.COMPLETED]: 'teal.50'\n  };\n\n  // 状态图标\n  const stateIcons = {\n    [ConversationStates.INITIAL]: '🆕',\n    [ConversationStates.COLLECTING_REQUIREMENT]: '📝',\n    [ConversationStates.CLARIFYING]: '🔍',\n    [ConversationStates.EXPECTATION_DRAFT]: '📋',\n    [ConversationStates.EXPECTATION_CONFIRMED]: '✅',\n    [ConversationStates.GENERATING]: '⚙️',\n    [ConversationStates.REVIEWING]: '👀',\n    [ConversationStates.COMPLETED]: '🏁'\n  };\n\n  // 更新WebSocket消息\n  useEffect(() => {\n    if (conversationId) {\n      // 订阅WebSocket更新\n      const subscription = subscribeToConversation(conversationId, update => {\n        if (update.messages) {\n          setMessages(update.messages);\n        }\n        if (update.state) {\n          setState(update.state);\n        }\n        if (update.currentExpectation) {\n          setCurrentExpectation(update.currentExpectation);\n        }\n      });\n      return () => {\n        // 取消订阅\n        if (subscription && subscription.unsubscribe) {\n          subscription.unsubscribe();\n        }\n      };\n    }\n  }, [conversationId]);\n\n  // 模拟订阅函数，实际项目中应该由WebSocket服务提供\n  const subscribeToConversation = (id, callback) => {\n    console.log(`订阅会话更新: ${id}`);\n    // 模拟实现，实际应该返回一个可取消的订阅\n    return {\n      unsubscribe: () => console.log(`取消订阅会话: ${id}`)\n    };\n  };\n\n  // 处理发送消息\n  const handleSendMessage = async messageText => {\n    if (!onSendMessage) return;\n\n    // 先本地添加用户消息以提供即时反馈\n    const userMessage = {\n      id: `local_${Date.now()}`,\n      sender: 'user',\n      content: messageText,\n      timestamp: new Date().toISOString()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    try {\n      // 调用父组件提供的发送消息函数\n      await onSendMessage(messageText);\n    } catch (error) {\n      // 显示错误或撤销本地添加的消息\n      console.error('发送消息失败:', error);\n    }\n  };\n\n  // 渲染会话状态指示\n  const renderStateIndicator = () => {\n    _s();\n    return /*#__PURE__*/_jsxDEV(Box, {\n      p: 2,\n      bg: useColorModeValue(stateBgColors[state] || 'gray.100', 'gray.700'),\n      borderRadius: \"md\",\n      mb: 4,\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontSize: \"xl\",\n          mr: 2,\n          children: stateIcons[state] || '🔄'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          flex: \"1\",\n          children: [/*#__PURE__*/_jsxDEV(Text, {\n            fontWeight: \"bold\",\n            children: getStateDescription(state)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 11\n          }, this), state === ConversationStates.GENERATING && /*#__PURE__*/_jsxDEV(Progress, {\n            size: \"xs\",\n            isIndeterminate: true,\n            colorScheme: \"blue\",\n            mt: 1\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 5\n    }, this);\n  };\n\n  // 渲染期望确认界面\n  _s(renderStateIndicator, \"3skuTHwppfEdh6aKNlffDjyTB8U=\", false, function () {\n    return [useColorModeValue];\n  });\n  const renderExpectationConfirmation = () => {\n    if (!currentExpectation || state !== ConversationStates.EXPECTATION_DRAFT) {\n      return null;\n    }\n    return /*#__PURE__*/_jsxDEV(Box, {\n      p: 4,\n      borderWidth: \"1px\",\n      borderRadius: \"md\",\n      bg: \"green.50\",\n      mb: 4,\n      children: [/*#__PURE__*/_jsxDEV(Heading, {\n        size: \"md\",\n        mb: 2,\n        children: \"\\u671F\\u671B\\u6458\\u8981\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        mb: 3,\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontWeight: \"bold\",\n          children: \"\\u540D\\u79F0:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Text, {\n          children: currentExpectation.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        mb: 3,\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontWeight: \"bold\",\n          children: \"\\u63CF\\u8FF0:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Text, {\n          children: currentExpectation.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        mb: 3,\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontWeight: \"bold\",\n          children: \"\\u9A8C\\u6536\\u6807\\u51C6:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(VStack, {\n          align: \"start\",\n          pl: 4,\n          children: currentExpectation.acceptanceCriteria.map((criterion, index) => /*#__PURE__*/_jsxDEV(Text, {\n            children: [\"\\u2022 \", criterion]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this), currentExpectation.constraints && currentExpectation.constraints.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n        mb: 3,\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontWeight: \"bold\",\n          children: \"\\u7EA6\\u675F\\u6761\\u4EF6:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(VStack, {\n          align: \"start\",\n          pl: 4,\n          children: currentExpectation.constraints.map((constraint, index) => /*#__PURE__*/_jsxDEV(Text, {\n            children: [\"\\u2022 \", constraint]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(HStack, {\n        spacing: 4,\n        mt: 4,\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          colorScheme: \"blue\",\n          onClick: () => onConfirmExpectation && onConfirmExpectation(currentExpectation),\n          children: \"\\u786E\\u8BA4\\u671F\\u671B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outline\",\n          onClick: () => onEditExpectation && onEditExpectation(currentExpectation),\n          children: \"\\u7F16\\u8F91\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }, this);\n  };\n\n  // 渲染生成代码按钮\n  const renderGenerateButton = () => {\n    if (state !== ConversationStates.EXPECTATION_CONFIRMED || !currentExpectation) {\n      return null;\n    }\n    return /*#__PURE__*/_jsxDEV(Box, {\n      textAlign: \"center\",\n      mb: 4,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        colorScheme: \"purple\",\n        size: \"lg\",\n        isLoading: loading,\n        loadingText: \"\\u51C6\\u5907\\u751F\\u6210...\",\n        onClick: () => onGenerateCode && onGenerateCode(currentExpectation.id),\n        children: \"\\u751F\\u6210\\u4EE3\\u7801\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    borderWidth: \"1px\",\n    borderRadius: \"lg\",\n    overflow: \"hidden\",\n    h: \"full\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    children: [renderStateIndicator(), renderExpectationConfirmation(), renderGenerateButton(), /*#__PURE__*/_jsxDEV(Box, {\n      flex: \"1\",\n      overflowY: \"auto\",\n      px: 4,\n      pb: 2,\n      children: /*#__PURE__*/_jsxDEV(MessageList, {\n        messages: messages,\n        loading: loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n      onSend: handleSendMessage,\n      disabled: loading || state === ConversationStates.GENERATING,\n      placeholder: state === ConversationStates.INITIAL ? \"请描述您的需求...\" : state === ConversationStates.CLARIFYING ? \"请回答问题，帮助我更好地理解您的需求...\" : \"输入消息...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 250,\n    columnNumber: 5\n  }, this);\n};\n_s2(ConversationPanel, \"GE2exriKjgkEgtPojEOtyHPon2g=\");\n_c = ConversationPanel;\nexport default ConversationPanel;\nvar _c;\n$RefreshReg$(_c, \"ConversationPanel\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Box","VStack","HStack","Text","Divider","Alert","AlertIcon","AlertTitle","AlertDescription","Button","useColorModeValue","Flex","Heading","Badge","Progress","MessageList","MessageInput","ConversationStates","getStateDescription","jsxDEV","_jsxDEV","ConversationPanel","conversationId","initialMessages","initialState","INITIAL","initialExpectation","onSendMessage","onGenerateCode","onConfirmExpectation","onEditExpectation","loading","_s2","_s","$RefreshSig$","messages","setMessages","state","setState","currentExpectation","setCurrentExpectation","stateBgColors","COLLECTING_REQUIREMENT","CLARIFYING","EXPECTATION_DRAFT","EXPECTATION_CONFIRMED","GENERATING","REVIEWING","COMPLETED","stateIcons","subscription","subscribeToConversation","update","unsubscribe","id","callback","console","log","handleSendMessage","messageText","userMessage","Date","now","sender","content","timestamp","toISOString","prev","error","renderStateIndicator","p","bg","borderRadius","mb","children","align","fontSize","mr","fileName","_jsxFileName","lineNumber","columnNumber","flex","fontWeight","size","isIndeterminate","colorScheme","mt","renderExpectationConfirmation","borderWidth","name","description","pl","acceptanceCriteria","map","criterion","index","constraints","length","constraint","spacing","onClick","variant","renderGenerateButton","textAlign","isLoading","loadingText","overflow","h","display","flexDirection","overflowY","px","pb","onSend","disabled","placeholder","_c","$RefreshReg$"],"sources":["/Users/ziyanzhou/Projects/devin-gen-expeta/access/ui/src/components/conversation/ConversationPanel.js"],"sourcesContent":["/**\n * @file ConversationPanel.js\n * @description 对话面板组件，实现用户与系统的对话交互\n * \n * 需求:\n * 1. 实现对话消息的展示，包括用户消息和系统消息\n * 2. 提供消息输入和发送功能\n * 3. 支持消息历史滚动和加载\n * 4. 显示对话状态和期望确认界面\n * 5. 响应式设计，适应不同屏幕尺寸\n * 6. 使用WebSocket实现实时消息更新\n * \n * 组件属性:\n * - conversationId: 当前会话ID\n * - initialMessages: 初始消息列表\n * - onSendMessage: 发送消息的回调函数\n */\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { \n  Box, \n  VStack, \n  HStack, \n  Text, \n  Divider, \n  Alert,\n  AlertIcon,\n  AlertTitle,\n  AlertDescription,\n  Button,\n  useColorModeValue,\n  Flex,\n  Heading,\n  Badge,\n  Progress\n} from '@chakra-ui/react';\nimport MessageList from './MessageList';\nimport MessageInput from './MessageInput';\nimport { ConversationStates, getStateDescription } from '../../../shared/states/ConversationStates';\n\n/**\n * 对话面板组件，实现用户与系统的对话交互\n * @param {Object} props 组件属性\n * @param {string} props.conversationId 当前会话ID\n * @param {Array} props.initialMessages 初始消息列表\n * @param {Function} props.onSendMessage 发送消息的回调函数\n */\nconst ConversationPanel = ({ \n  conversationId,\n  initialMessages = [],\n  initialState = ConversationStates.INITIAL,\n  initialExpectation = null,\n  onSendMessage,\n  onGenerateCode,\n  onConfirmExpectation,\n  onEditExpectation,\n  loading = false\n}) => {\n  const [messages, setMessages] = useState(initialMessages);\n  const [state, setState] = useState(initialState);\n  const [currentExpectation, setCurrentExpectation] = useState(initialExpectation);\n\n  // 状态背景色\n  const stateBgColors = {\n    [ConversationStates.INITIAL]: 'gray.100',\n    [ConversationStates.COLLECTING_REQUIREMENT]: 'blue.50',\n    [ConversationStates.CLARIFYING]: 'blue.100',\n    [ConversationStates.EXPECTATION_DRAFT]: 'green.50',\n    [ConversationStates.EXPECTATION_CONFIRMED]: 'green.100',\n    [ConversationStates.GENERATING]: 'purple.50',\n    [ConversationStates.REVIEWING]: 'orange.50',\n    [ConversationStates.COMPLETED]: 'teal.50'\n  };\n\n  // 状态图标\n  const stateIcons = {\n    [ConversationStates.INITIAL]: '🆕',\n    [ConversationStates.COLLECTING_REQUIREMENT]: '📝',\n    [ConversationStates.CLARIFYING]: '🔍',\n    [ConversationStates.EXPECTATION_DRAFT]: '📋',\n    [ConversationStates.EXPECTATION_CONFIRMED]: '✅',\n    [ConversationStates.GENERATING]: '⚙️',\n    [ConversationStates.REVIEWING]: '👀',\n    [ConversationStates.COMPLETED]: '🏁'\n  };\n\n  // 更新WebSocket消息\n  useEffect(() => {\n    if (conversationId) {\n      // 订阅WebSocket更新\n      const subscription = subscribeToConversation(conversationId, (update) => {\n        if (update.messages) {\n          setMessages(update.messages);\n        }\n        if (update.state) {\n          setState(update.state);\n        }\n        if (update.currentExpectation) {\n          setCurrentExpectation(update.currentExpectation);\n        }\n      });\n      \n      return () => {\n        // 取消订阅\n        if (subscription && subscription.unsubscribe) {\n          subscription.unsubscribe();\n        }\n      };\n    }\n  }, [conversationId]);\n\n  // 模拟订阅函数，实际项目中应该由WebSocket服务提供\n  const subscribeToConversation = (id, callback) => {\n    console.log(`订阅会话更新: ${id}`);\n    // 模拟实现，实际应该返回一个可取消的订阅\n    return {\n      unsubscribe: () => console.log(`取消订阅会话: ${id}`)\n    };\n  };\n\n  // 处理发送消息\n  const handleSendMessage = async (messageText) => {\n    if (!onSendMessage) return;\n    \n    // 先本地添加用户消息以提供即时反馈\n    const userMessage = {\n      id: `local_${Date.now()}`,\n      sender: 'user',\n      content: messageText,\n      timestamp: new Date().toISOString()\n    };\n    \n    setMessages(prev => [...prev, userMessage]);\n    \n    try {\n      // 调用父组件提供的发送消息函数\n      await onSendMessage(messageText);\n    } catch (error) {\n      // 显示错误或撤销本地添加的消息\n      console.error('发送消息失败:', error);\n    }\n  };\n\n  // 渲染会话状态指示\n  const renderStateIndicator = () => (\n    <Box \n      p={2} \n      bg={useColorModeValue(stateBgColors[state] || 'gray.100', 'gray.700')}\n      borderRadius=\"md\"\n      mb={4}\n    >\n      <Flex align=\"center\">\n        <Text fontSize=\"xl\" mr={2}>{stateIcons[state] || '🔄'}</Text>\n        <Box flex=\"1\">\n          <Text fontWeight=\"bold\">{getStateDescription(state)}</Text>\n          {state === ConversationStates.GENERATING && (\n            <Progress size=\"xs\" isIndeterminate colorScheme=\"blue\" mt={1} />\n          )}\n        </Box>\n      </Flex>\n    </Box>\n  );\n\n  // 渲染期望确认界面\n  const renderExpectationConfirmation = () => {\n    if (!currentExpectation || state !== ConversationStates.EXPECTATION_DRAFT) {\n      return null;\n    }\n    \n    return (\n      <Box \n        p={4} \n        borderWidth=\"1px\" \n        borderRadius=\"md\" \n        bg=\"green.50\" \n        mb={4}\n      >\n        <Heading size=\"md\" mb={2}>期望摘要</Heading>\n        \n        <Box mb={3}>\n          <Text fontWeight=\"bold\">名称:</Text>\n          <Text>{currentExpectation.name}</Text>\n        </Box>\n        \n        <Box mb={3}>\n          <Text fontWeight=\"bold\">描述:</Text>\n          <Text>{currentExpectation.description}</Text>\n        </Box>\n        \n        <Box mb={3}>\n          <Text fontWeight=\"bold\">验收标准:</Text>\n          <VStack align=\"start\" pl={4}>\n            {currentExpectation.acceptanceCriteria.map((criterion, index) => (\n              <Text key={index}>• {criterion}</Text>\n            ))}\n          </VStack>\n        </Box>\n        \n        {currentExpectation.constraints && currentExpectation.constraints.length > 0 && (\n          <Box mb={3}>\n            <Text fontWeight=\"bold\">约束条件:</Text>\n            <VStack align=\"start\" pl={4}>\n              {currentExpectation.constraints.map((constraint, index) => (\n                <Text key={index}>• {constraint}</Text>\n              ))}\n            </VStack>\n          </Box>\n        )}\n        \n        <HStack spacing={4} mt={4}>\n          <Button \n            colorScheme=\"blue\" \n            onClick={() => onConfirmExpectation && onConfirmExpectation(currentExpectation)}\n          >\n            确认期望\n          </Button>\n          <Button \n            variant=\"outline\" \n            onClick={() => onEditExpectation && onEditExpectation(currentExpectation)}\n          >\n            编辑\n          </Button>\n        </HStack>\n      </Box>\n    );\n  };\n\n  // 渲染生成代码按钮\n  const renderGenerateButton = () => {\n    if (state !== ConversationStates.EXPECTATION_CONFIRMED || !currentExpectation) {\n      return null;\n    }\n    \n    return (\n      <Box textAlign=\"center\" mb={4}>\n        <Button \n          colorScheme=\"purple\"\n          size=\"lg\"\n          isLoading={loading}\n          loadingText=\"准备生成...\"\n          onClick={() => onGenerateCode && onGenerateCode(currentExpectation.id)}\n        >\n          生成代码\n        </Button>\n      </Box>\n    );\n  };\n\n  return (\n    <Box \n      borderWidth=\"1px\" \n      borderRadius=\"lg\" \n      overflow=\"hidden\" \n      h=\"full\" \n      display=\"flex\" \n      flexDirection=\"column\"\n    >\n      {renderStateIndicator()}\n      \n      {renderExpectationConfirmation()}\n      \n      {renderGenerateButton()}\n      \n      <Box flex=\"1\" overflowY=\"auto\" px={4} pb={2}>\n        <MessageList messages={messages} loading={loading} />\n      </Box>\n      \n      <MessageInput \n        onSend={handleSendMessage} \n        disabled={loading || state === ConversationStates.GENERATING}\n        placeholder={\n          state === ConversationStates.INITIAL \n            ? \"请描述您的需求...\" \n            : state === ConversationStates.CLARIFYING \n              ? \"请回答问题，帮助我更好地理解您的需求...\" \n              : \"输入消息...\"\n        }\n      />\n    </Box>\n  );\n};\n\nexport default ConversationPanel;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}