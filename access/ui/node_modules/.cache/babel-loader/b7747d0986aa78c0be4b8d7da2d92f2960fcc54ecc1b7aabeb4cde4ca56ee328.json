{"ast":null,"code":"/**\n * @file useGeneration.js\n * @description 代码生成的自定义Hook\n * \n * 需求:\n * 1. 封装代码生成逻辑，简化组件代码\n * 2. 管理生成状态和结果\n * 3. 处理生成请求和结果获取\n * 4. 提供进度更新通知\n * \n * 返回值:\n * - generation: 当前生成结果\n * - generateCode: 生成代码的函数\n * - progress: 生成进度\n * - downloadCode: 下载代码的函数\n * - loading: 加载状态\n * - error: 错误信息\n */import{useState,useEffect,useCallback}from'react';import{generationService,expectationService}from'../services/api';import webSocketService from'../services/WebSocketService';// 导入其他必要依赖\n/**\n * 代码生成的自定义Hook\n * @param {string} generationId 生成ID\n */const useGeneration=generationId=>{const[generation,setGeneration]=useState(null);const[expectation,setExpectation]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);// 加载生成结果\nconst loadGeneration=useCallback(async id=>{if(!id)return;setLoading(true);setError(null);try{const response=await generationService.getGeneration(id);setGeneration(response.data);// 如果有关联的期望ID，加载期望信息\nif(response.data.expectationId){try{const expResponse=await expectationService.getExpectation(response.data.expectationId);setExpectation(expResponse.data);}catch(expError){console.error('加载期望信息失败:',expError);}}return response.data;}catch(err){setError(err.message||'加载生成结果失败');console.error('加载生成结果失败:',err);throw err;}finally{setLoading(false);}},[]);// 加载生成历史\nconst loadGenerations=useCallback(async()=>{setLoading(true);setError(null);try{const response=await generationService.getGenerations();return response.data;}catch(err){setError(err.message||'加载生成历史失败');console.error('加载生成历史失败:',err);throw err;}finally{setLoading(false);}},[]);// 下载代码\nconst downloadCode=useCallback(async id=>{setLoading(true);setError(null);try{const response=await generationService.downloadGeneration(id||generationId);// 处理下载\nconst url=window.URL.createObjectURL(new Blob([response.data]));const link=document.createElement('a');link.href=url;link.setAttribute('download',`generation-${id||generationId}.zip`);document.body.appendChild(link);link.click();document.body.removeChild(link);return true;}catch(err){setError(err.message||'下载代码失败');console.error('下载代码失败:',err);return false;}finally{setLoading(false);}},[generationId]);// 自动加载生成结果\nuseEffect(()=>{if(generationId){loadGeneration(generationId);}},[generationId,loadGeneration]);return{generation,expectation,loading,error,loadGeneration,loadGenerations,downloadCode};};export default useGeneration;","map":{"version":3,"names":["useState","useEffect","useCallback","generationService","expectationService","webSocketService","useGeneration","generationId","generation","setGeneration","expectation","setExpectation","loading","setLoading","error","setError","loadGeneration","id","response","getGeneration","data","expectationId","expResponse","getExpectation","expError","console","err","message","loadGenerations","getGenerations","downloadCode","downloadGeneration","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","removeChild"],"sources":["/Users/ziyanzhou/Projects/devin-gen-expeta/access/ui/src/hooks/useGeneration.js"],"sourcesContent":["/**\n * @file useGeneration.js\n * @description 代码生成的自定义Hook\n * \n * 需求:\n * 1. 封装代码生成逻辑，简化组件代码\n * 2. 管理生成状态和结果\n * 3. 处理生成请求和结果获取\n * 4. 提供进度更新通知\n * \n * 返回值:\n * - generation: 当前生成结果\n * - generateCode: 生成代码的函数\n * - progress: 生成进度\n * - downloadCode: 下载代码的函数\n * - loading: 加载状态\n * - error: 错误信息\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { generationService, expectationService } from '../services/api';\nimport webSocketService from '../services/WebSocketService';\n// 导入其他必要依赖\n\n/**\n * 代码生成的自定义Hook\n * @param {string} generationId 生成ID\n */\nconst useGeneration = (generationId) => {\n  const [generation, setGeneration] = useState(null);\n  const [expectation, setExpectation] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  \n  // 加载生成结果\n  const loadGeneration = useCallback(async (id) => {\n    if (!id) return;\n    \n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await generationService.getGeneration(id);\n      setGeneration(response.data);\n      \n      // 如果有关联的期望ID，加载期望信息\n      if (response.data.expectationId) {\n        try {\n          const expResponse = await expectationService.getExpectation(response.data.expectationId);\n          setExpectation(expResponse.data);\n        } catch (expError) {\n          console.error('加载期望信息失败:', expError);\n        }\n      }\n      \n      return response.data;\n    } catch (err) {\n      setError(err.message || '加载生成结果失败');\n      console.error('加载生成结果失败:', err);\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // 加载生成历史\n  const loadGenerations = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await generationService.getGenerations();\n      return response.data;\n    } catch (err) {\n      setError(err.message || '加载生成历史失败');\n      console.error('加载生成历史失败:', err);\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // 下载代码\n  const downloadCode = useCallback(async (id) => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await generationService.downloadGeneration(id || generationId);\n      \n      // 处理下载\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', `generation-${id || generationId}.zip`);\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      return true;\n    } catch (err) {\n      setError(err.message || '下载代码失败');\n      console.error('下载代码失败:', err);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, [generationId]);\n\n  // 自动加载生成结果\n  useEffect(() => {\n    if (generationId) {\n      loadGeneration(generationId);\n    }\n  }, [generationId, loadGeneration]);\n\n  return {\n    generation,\n    expectation,\n    loading,\n    error,\n    loadGeneration,\n    loadGenerations,\n    downloadCode\n  };\n};\n\nexport default useGeneration;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}